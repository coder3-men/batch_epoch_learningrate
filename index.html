<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¤‘1 ë¨¸ì‹ ëŸ¬ë‹ ì‹¤í—˜ì‹¤</title>
    <!-- Tailwind CSS (ìŠ¤íƒ€ì¼ë§) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js (ê·¸ë˜í”„) -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- TensorFlow.js (ë¨¸ì‹ ëŸ¬ë‹) -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; }
        .slider-thumb::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #4F46E5;
            cursor: pointer;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <!-- í—¤ë” -->
    <header class="bg-indigo-600 text-white p-6 text-center shadow-lg">
        <h1 class="text-3xl font-bold mb-2">ğŸ§ª ë¨¸ì‹ ëŸ¬ë‹ ì„±ì  ì˜ˆì¸¡ ì‹¤í—˜ì‹¤</h1>
        <p class="text-indigo-100">"ê³µë¶€ë¥¼ ì–¼ë§ˆë‚˜ í•˜ë©´ ëª‡ ì ì„ ë°›ì„ê¹Œ?" AIì—ê²Œ ì˜ˆì¸¡í•˜ëŠ” ë²•ì„ ê°€ë¥´ì³ë³´ì„¸ìš”!</p>
    </header>

    <main class="max-w-6xl mx-auto p-4 flex flex-col lg:flex-row gap-6 mt-4">
        
        <!-- ì™¼ìª½: ì»¨íŠ¸ë¡¤ íŒ¨ë„ -->
        <section class="lg:w-1/3 bg-white p-6 rounded-2xl shadow-md border border-slate-200">
            <h2 class="text-xl font-bold mb-6 flex items-center gap-2">
                <span>ğŸ›ï¸</span> í•™ìŠµ ì„¤ì • (í•˜ì´í¼íŒŒë¼ë¯¸í„°)
            </h2>

            <!-- 1. ì—í¬í¬ (Epochs) -->
            <div class="mb-6">
                <div class="flex justify-between mb-2">
                    <label class="font-bold text-slate-700">1. ì—í¬í¬ (Epochs)</label>
                    <span id="val-epochs" class="text-indigo-600 font-bold">50íšŒ</span>
                </div>
                <input type="range" id="epochs" min="10" max="200" step="10" value="50" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer slider-thumb">
                <p class="text-xs text-slate-500 mt-2 bg-slate-100 p-2 rounded">
                    ğŸ“– <strong>ë¬¸ì œì§‘ì„ ëª‡ ë²ˆ ë°˜ë³µí•´ì„œ ë³¼ê¹Œìš”?</strong><br>
                    ë°˜ë³µ íšŸìˆ˜ê°€ ë§ì„ìˆ˜ë¡ ì •í™•í•´ì§€ì§€ë§Œ, ë„ˆë¬´ ë§ìœ¼ë©´ ë‹µì„ ì™¸ì›Œë²„ë¦´ ìˆ˜ë„ ìˆì–´ìš”(ê³¼ì í•©).
                </p>
            </div>

            <!-- 2. ë°°ì¹˜ í¬ê¸° (Batch Size) -->
            <div class="mb-6">
                <div class="flex justify-between mb-2">
                    <label class="font-bold text-slate-700">2. ë°°ì¹˜ í¬ê¸° (Batch Size)</label>
                    <span id="val-batch" class="text-indigo-600 font-bold">16ëª…</span>
                </div>
                <input type="range" id="batchSize" min="4" max="64" step="4" value="16" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer slider-thumb">
                <p class="text-xs text-slate-500 mt-2 bg-slate-100 p-2 rounded">
                    ğŸ“¦ <strong>í•œ ë²ˆì— ëª‡ ëª…ì˜ í•™ìƒ ë°ì´í„°ë¥¼ í™•ì¸í• ê¹Œìš”?</strong><br>
                    ì¡°ê¸ˆì”© ìì£¼ í™•ì¸í•˜ë©´ í•™ìŠµ ë°©í–¥ì„ ë¹¨ë¦¬ ê³ ì¹˜ê³ , ë§ì´ì”© í™•ì¸í•˜ë©´ ì•ˆì •ì ìœ¼ë¡œ ë°°ì›ë‹ˆë‹¤.
                </p>
            </div>

            <!-- 3. í•™ìŠµë¥  (Learning Rate) -->
            <div class="mb-8">
                <div class="flex justify-between mb-2">
                    <label class="font-bold text-slate-700">3. í•™ìŠµë¥  (Learning Rate)</label>
                    <span id="val-lr" class="text-indigo-600 font-bold">0.1</span>
                </div>
                <input type="range" id="learningRate" min="0.001" max="0.5" step="0.001" value="0.1" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer slider-thumb">
                <p class="text-xs text-slate-500 mt-2 bg-slate-100 p-2 rounded">
                    ğŸƒ <strong>ì˜¤ì°¨ë¥¼ ë°œê²¬í–ˆì„ ë•Œ ì–¼ë§ˆë‚˜ í¬ê²Œ ê³ ì¹ ê¹Œìš”?</strong><br>
                    ë„ˆë¬´ ì‘ìœ¼ë©´ í•™ìŠµì´ ëŠë¦¬ê³ , ë„ˆë¬´ í¬ë©´ ì˜¤íˆë ¤ ì—‰ëš±í•œ ê°’ìœ¼ë¡œ íŠˆ ìˆ˜ ìˆì–´ìš”.
                </p>
            </div>

            <button id="trainBtn" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-4 rounded-xl transition-all transform hover:scale-105 shadow-lg flex justify-center items-center gap-2">
                <span>ğŸš€ AI í•™ìŠµ ì‹œì‘í•˜ê¸°</span>
            </button>
            <div id="status" class="mt-4 text-center text-sm font-semibold text-slate-400">ì¤€ë¹„ ì™„ë£Œ</div>
        </section>

        <!-- ì˜¤ë¥¸ìª½: ì‹œê°í™” -->
        <section class="lg:w-2/3 flex flex-col gap-4">
            <!-- ë©”ì¸ ê·¸ë˜í”„ -->
            <div class="bg-white p-4 rounded-2xl shadow-md border border-slate-200 relative">
                <h3 class="text-lg font-bold text-slate-700 mb-2">ğŸ“Š ê³µë¶€ ì‹œê°„ vs ì„±ì  ê·¸ë˜í”„</h3>
                <div class="relative h-80 w-full">
                    <canvas id="mainChart"></canvas>
                </div>
                <div class="absolute top-4 right-4 bg-white/80 p-2 rounded shadow text-xs">
                    <div class="flex items-center gap-2"><span class="w-3 h-3 rounded-full bg-blue-500"></span> ì‹¤ì œ í•™ìƒ ë°ì´í„°</div>
                    <div class="flex items-center gap-2"><span class="w-3 h-3 rounded-full bg-red-500"></span> AIì˜ ì˜ˆì¸¡</div>
                </div>
            </div>

            <!-- ì†ì‹¤(Loss) ê·¸ë˜í”„ -->
            <div class="bg-white p-4 rounded-2xl shadow-md border border-slate-200">
                <h3 class="text-lg font-bold text-slate-700 mb-2">ğŸ“‰ ì˜ˆì¸¡ ì˜¤ì°¨(Loss) ê°ì†Œ ê·¸ë˜í”„</h3>
                <p class="text-xs text-slate-500 mb-2">ì´ ì„ ì´ ë°”ë‹¥ìœ¼ë¡œ ë‚´ë ¤ê°ˆìˆ˜ë¡ AIì˜ ì˜ˆì¸¡ì´ ì •í™•í•´ì§€ëŠ” ì¤‘ì…ë‹ˆë‹¤!</p>
                <div class="relative h-40 w-full">
                    <canvas id="lossChart"></canvas>
                </div>
            </div>
        </section>
    </main>

    <footer class="text-center p-8 text-slate-500 text-sm">
        ë§Œë“ ì´: AI ì„ ìƒë‹˜ | ì¤‘í•™êµ ì •ë³´ êµê³¼ìš© ìë£Œ
    </footer>

    <script>
        // --- 1. ë°ì´í„° ìƒì„± (ê³µë¶€ ì‹œê°„ vs ì„±ì ) ---
        // 0~10ì‹œê°„ ê³µë¶€í•˜ë©´ ì„±ì ì´ ì˜¤ë¥´ëŠ” ë¹„ì„ í˜•(ê³¡ì„ ) ê´€ê³„ ìƒì„±
        const generateData = (numPoints) => {
            const xs = [];
            const ys = [];
            for (let i = 0; i < numPoints; i++) {
                // ê³µë¶€ ì‹œê°„: 0 ~ 10ì‹œê°„ (ëœë¤)
                const studyHours = Math.random() * 10;
                
                // ì„±ì  ê³„ì‚° ê³µì‹: 100 - (10 - ì‹œê°„)^2 + ë…¸ì´ì¦ˆ
                // (10ì‹œê°„ ê³µë¶€í•˜ë©´ 100ì ì— ê°€ê¹ê³ , 0ì‹œê°„ì´ë©´ 0ì ì— ê°€ê¹Œìš´ ê³¡ì„ )
                let score = 100 - Math.pow(10 - studyHours, 2);
                
                // í˜„ì‹¤ê°ì„ ìœ„í•œ ë…¸ì´ì¦ˆ ì¶”ê°€ (Â±10ì  ì •ë„ì˜ ê°œì¸ì°¨)
                score += (Math.random() * 20 - 10);
                
                // ì ìˆ˜ëŠ” 0~100ì  ì‚¬ì´ë¡œ ì œí•œ
                score = Math.max(0, Math.min(100, score));

                xs.push(studyHours);
                ys.push(score);
            }
            return { xs, ys };
        };

        const dataSize = 100;
        const { xs: rawXs, ys: rawYs } = generateData(dataSize);

        // --- 2. Chart.js ì„¤ì • ---
        const ctxMain = document.getElementById('mainChart').getContext('2d');
        const ctxLoss = document.getElementById('lossChart').getContext('2d');

        // ë©”ì¸ ê·¸ë˜í”„ (ì‚°ì ë„ + ì„  ê·¸ë˜í”„)
        const mainChart = new Chart(ctxMain, {
            type: 'scatter',
            data: {
                datasets: [
                    {
                        label: 'í•™ìƒ ë°ì´í„°',
                        data: rawXs.map((x, i) => ({ x: x, y: rawYs[i] })),
                        backgroundColor: 'rgba(59, 130, 246, 0.5)', // íŒŒë€ ì 
                        pointRadius: 4
                    },
                    {
                        label: 'AIì˜ ì„±ì  ì˜ˆì¸¡',
                        type: 'line',
                        data: [], // ì´ˆê¸°ì—” ë¹„ì–´ìˆìŒ
                        borderColor: 'rgba(239, 68, 68, 1)', // ë¹¨ê°„ ì„ 
                        borderWidth: 3,
                        pointRadius: 0,
                        fill: false,
                        tension: 0.3 // ê³¡ì„ ì„ ë¶€ë“œëŸ½ê²Œ
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                animation: false,
                scales: {
                    x: { 
                        min: 0, max: 10.5, 
                        title: { display: true, text: 'ê³µë¶€ ì‹œê°„ (ì‹œê°„)', font: {weight: 'bold'} } 
                    },
                    y: { 
                        min: 0, max: 105, 
                        title: { display: true, text: 'ì‹œí—˜ ì ìˆ˜ (ì )', font: {weight: 'bold'} } 
                    }
                }
            }
        });

        // ì†ì‹¤(Loss) ê·¸ë˜í”„
        const lossChart = new Chart(ctxLoss, {
            type: 'line',
            data: {
                labels: [],
                datasets: [{
                    label: 'ì˜¤ì°¨(Loss)',
                    data: [],
                    borderColor: '#10B981', // ì´ˆë¡ìƒ‰
                    borderWidth: 2,
                    pointRadius: 0,
                    fill: true,
                    backgroundColor: 'rgba(16, 185, 129, 0.1)'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                animation: false,
                scales: {
                    x: { display: false },
                    y: { beginAtZero: true }
                },
                plugins: { legend: { display: false } }
            }
        });

        // --- 3. UI ì—…ë°ì´íŠ¸ ë¡œì§ ---
        const epochSlider = document.getElementById('epochs');
        const batchSlider = document.getElementById('batchSize');
        const lrSlider = document.getElementById('learningRate');
        
        const updateLabels = () => {
            document.getElementById('val-epochs').innerText = epochSlider.value + "íšŒ";
            document.getElementById('val-batch').innerText = batchSlider.value + "ê°œ";
            document.getElementById('val-lr').innerText = lrSlider.value;
        };

        [epochSlider, batchSlider, lrSlider].forEach(input => {
            input.addEventListener('input', updateLabels);
        });

        // --- 4. TensorFlow.js ëª¨ë¸ ë° í•™ìŠµ ---
        let model;
        let isTraining = false;

        async function trainModel() {
            if (isTraining) return;
            isTraining = true;
            
            const trainBtn = document.getElementById('trainBtn');
            const statusDiv = document.getElementById('status');
            
            trainBtn.disabled = true;
            trainBtn.classList.add('opacity-50', 'cursor-not-allowed');
            trainBtn.innerHTML = `<span>â³ AIê°€ ê³µë¶€ë²•ì„ ë°°ìš°ëŠ” ì¤‘...</span>`;
            statusDiv.innerText = "ë°ì´í„°ë¥¼ ë¶„ì„í•˜ê³  ìˆì–´ìš”...";
            statusDiv.className = "mt-4 text-center text-sm font-bold text-indigo-600 animate-pulse";

            // 1. ê°’ ê°€ì ¸ì˜¤ê¸°
            const epochs = parseInt(epochSlider.value);
            const batchSize = parseInt(batchSlider.value);
            const learningRate = parseFloat(lrSlider.value);

            // 2. ëª¨ë¸ ìƒì„±
            model = tf.sequential();
            // ì…ë ¥: 1ê°œ (ê³µë¶€ ì‹œê°„) -> ì€ë‹‰ì¸µ (8ê°œ ë‰´ëŸ°) -> ì€ë‹‰ì¸µ (8ê°œ ë‰´ëŸ°) -> ì¶œë ¥: 1ê°œ (ì˜ˆìƒ ì ìˆ˜)
            model.add(tf.layers.dense({ units: 8, inputShape: [1], activation: 'relu' })); 
            model.add(tf.layers.dense({ units: 8, activation: 'relu' }));
            model.add(tf.layers.dense({ units: 1 }));

            // 3. ëª¨ë¸ ì»´íŒŒì¼
            model.compile({
                optimizer: tf.train.adam(learningRate),
                loss: 'meanSquaredError'
            });

            // â˜… ë°ì´í„° ì •ê·œí™” (Normalization) â˜…
            // ë¨¸ì‹ ëŸ¬ë‹ì€ 0~1 ì‚¬ì´ì˜ ì‘ì€ ìˆ«ìë¥¼ ì¢‹ì•„í•©ë‹ˆë‹¤. 
            // ê³µë¶€ì‹œê°„(0~10)ì€ 10ìœ¼ë¡œ, ì ìˆ˜(0~100)ëŠ” 100ìœ¼ë¡œ ë‚˜ëˆ ì„œ ì‘ê²Œ ë§Œë“­ë‹ˆë‹¤.
            const normXs = rawXs.map(x => x / 10);
            const normYs = rawYs.map(y => y / 100);

            const xsTensor = tf.tensor2d(normXs, [normXs.length, 1]);
            const ysTensor = tf.tensor2d(normYs, [normYs.length, 1]);

            // ì°¨íŠ¸ ì´ˆê¸°í™”
            lossChart.data.labels = [];
            lossChart.data.datasets[0].data = [];
            lossChart.update();

            // ì˜ˆì¸¡ ì„ ì„ ê·¸ë¦¬ê¸° ìœ„í•œ Xê°’ë“¤ (0ì‹œê°„ ~ 10ì‹œê°„ì„ 100ê°œë¡œ ìª¼ê°¬)
            const predictXsRaw = [];
            for(let i=0; i<=100; i++) predictXsRaw.push(i/10); // 0.0, 0.1 ... 10.0
            const predictXsTensor = tf.tensor2d(predictXsRaw.map(x => x / 10), [101, 1]); // ì •ê·œí™”í•´ì„œ í…ì„œë¡œ

            // 4. í•™ìŠµ ì‹œì‘
            await model.fit(xsTensor, ysTensor, {
                epochs: epochs,
                batchSize: batchSize,
                shuffle: true,
                callbacks: {
                    onEpochEnd: async (epoch, logs) => {
                        // ì˜¤ì°¨ ê·¸ë˜í”„ ì—…ë°ì´íŠ¸
                        lossChart.data.labels.push(epoch);
                        lossChart.data.datasets[0].data.push(logs.loss);
                        lossChart.update();

                        // ì˜ˆì¸¡ ì„  ê·¸ë¦¬ê¸°
                        const preds = model.predict(predictXsTensor);
                        const predDataNorm = await preds.data(); // 0~1 ì‚¬ì´ ê°’ìœ¼ë¡œ ë‚˜ì˜´
                        preds.dispose();

                        // ë‹¤ì‹œ ì›ë˜ ì ìˆ˜(0~100ì )ë¡œ ë˜ëŒë ¤ì„œ ê·¸ë˜í”„ì— ê·¸ë¦¬ê¸°
                        const chartData = [];
                        for(let i=0; i<=100; i++) {
                            const xVal = predictXsRaw[i]; // ì‹œê°„
                            const yVal = predDataNorm[i] * 100; // ì •ê·œí™”ëœ ê°’ì„ 100 ê³±í•´ì„œ ë³µêµ¬
                            chartData.push({ x: xVal, y: yVal });
                        }
                        
                        mainChart.data.datasets[1].data = chartData;
                        mainChart.update();

                        statusDiv.innerText = `${epoch + 1}/${epochs}ë²ˆ í•™ìŠµ ì¤‘... (ì˜¤ì°¨: ${logs.loss.toFixed(4)})`;
                        
                        await tf.nextFrame();
                    }
                }
            });

            // í•™ìŠµ ì¢…ë£Œ í›„ ì •ë¦¬
            xsTensor.dispose();
            ysTensor.dispose();
            predictXsTensor.dispose();

            isTraining = false;
            trainBtn.disabled = false;
            trainBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            trainBtn.innerHTML = `<span>ğŸš€ AI í•™ìŠµ ì‹œì‘í•˜ê¸°</span>`;
            statusDiv.innerText = "í•™ìŠµ ì™„ë£Œ! ë¹¨ê°„ ì„ ì´ íŒŒë€ ì ë“¤(í•™ìƒ ë°ì´í„°)ì„ ì˜ ë”°ë¼ê°€ë‚˜ìš”?";
            statusDiv.className = "mt-4 text-center text-sm font-bold text-green-600";
        }

        document.getElementById('trainBtn').addEventListener('click', trainModel);
    </script>
</body>
</html>
